{% extends "base.html" %}
{% block content %}
    
    <h2 class="center-align">Manage Recipes</h2>
       

        <div class="row">
        {% for recipe in recipes %}
            {% set recipe_number = loop.index %}
            <div class="col s12 m6 l4">
                <div class="card recipe{{ recipe_number }} recipe-card hoverable">
                    <div class="card-image">
                        <img src="{{ recipe.image_url }}">
                        <span class="card-title text-shadow">{{ recipe.country }}</span>
                    </div>
                    <div class="card-content center-align">
                        <h5>{{ recipe.recipe_name }}</h5>
                        {{ is_recipe_page }}
                        <p>{{ recipe.recipe_description }}</p>
                    </div>
                    <!-- like button -->
                    <div class="center-align" id="like_counter">
                        <form method="POST" action="{{ url_for('like_recipe') }}">
                            <input type="hidden" id="like_recipe" name="like_recipe" value="{{ recipe._id }}">
                            {% if session['user'] %}
                                <!-- https://jinja.palletsprojects.com/en/2.10.x/templates/#assignments -->
                                <!-- check if user has liked this recipe -->
                                {% set ns = namespace(found=false) %}
                                {% for likes in user_likes  %}
                                    {% if likes|string == recipe._id|string %}
                                        {% set ns.found = true %}
                                    {% endif %}
                                {% endfor %}
                                <!-- if user has already liked the recipe, colour icon blue -->
                                {% if ns.found %}
                                    <button type="submit" id="like_button_blue" class="btn-floating blue">
                                        <i class="far fa-thumbs-up"></i>
                                    </button>
                                    <span id="liked">{{ recipe.likes }}</span>
                                {% else %}
                                    <button type="submit" id="like_button" class="btn-floating">
                                        <i class="far fa-thumbs-up"></i>
                                    </button>
                                    <span id="not_liked">{{ recipe.likes }}</span>
                                {% endif %}
                            {% else %}
                            <a id="like_button" class="btn-floating modal-trigger" href="#modal2">
                                <i class="far fa-thumbs-up"></i>
                            </a>
                            <span>{{ recipe.likes }}</span>
                            {% endif %}
                        </form>
                    </div>
                    <!-- /like button -->
                    <div id="added_by">
                        <span>Added by: {{ recipe.added_by }}</span>
                    </div>
                    <!-- favourite button -->
                    <div class="favourite">
                        <form method="POST" action="{{ url_for('add_to_favourites') }}">
                            <input type="hidden" id="fav_recipe" name="fav_recipe" value="{{ recipe._id }}">
                            {% if session['user'] %}
                                <!-- https://jinja.palletsprojects.com/en/2.10.x/templates/#assignments -->
                                <!-- check if user has liked this recipe -->
                                {% set ns = namespace(found=false) %}
                                {% for favourites in user_favourites  %}
                                    {% if favourites|string == recipe._id|string %}
                                        {% set ns.found = true %}
                                    {% endif %}
                                {% endfor %}
                                <!-- if user has already liked the recipe, colour icon blue -->
                                {% if ns.found %}
                                    <button type="submit" id="favourite" class="btn-floating red">
                                        <i class="far fa-heart"></i>
                                    </button>
                                {% else %}
                                    <button id="favourite_button" type="submit" class="btn-floating">
                                        <i class="far fa-heart"></i>
                                    </button>
                                {% endif %}
                            {% else %}
                            <a id="favourite" class="btn-floating modal-trigger" href="#modal2">
                                <i class="far fa-heart"></i>
                            </a>
                            {% endif %}
                        </form>
                    </div>
                    <!-- /favourite button -->
                    <div class="card-action center-align">
                        <form method="POST" action="{{ url_for('recipe_details') }}">
                            <input type="hidden" id="see_recipe" name="see_recipe" value="{{ recipe._id }}">
                            <!-- set manage_recipes to true for back button redirect on Recipe details -->
                            <input type="hidden" id="manage_recipes" name="manage_recipes" value="{{ True }}">
                            <button type="submit" class="btn waves-effect waves-light submit-buttons">
                                See Recipe
                            </button>
                        </form>
                    </div>
                </div>
                <div class="edit-buttons center-align">
                    <a href="{{ url_for('edit_recipe', recipe_id=recipe._id, manage_recipes=True) }}" class="btn-small">Edit</a>
                    <a href="#delete_recipe{{ loop.index }}" class="btn-small red modal-trigger">Delete</a>
                    {% set recipe = recipe._id %}
                    <!-- delete recipe modal structure -->
                <div id="delete_recipe{{ loop.index }}" class="modal modal-small">
                    <div class="modal-content">
                        <p>Are you sure you want to delete this recipe?</p>
                    </div>
                <div class="modal-footer center-align">
                    <div class="center-align">
                        <a href="{{ url_for('delete_recipe', recipe_id=recipe, manage_recipes=True) }}" class="modal-close waves-effect waves-green btn-small">Yes</a>
                        <a href="#!" class="modal-close waves-effect waves-green btn-small red">No</a>                
                    </div>
                </div>
                </div>
                </div>
            </div>
            
        {%  endfor %}
    </div>

{% endblock %}
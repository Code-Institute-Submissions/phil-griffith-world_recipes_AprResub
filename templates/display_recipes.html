{% extends "base.html" %}

{% block content %}    

    <!-- recipes -->
    <div class="row">
        {% for recipe in recipes %}
        {% set recipe_number = loop.index %}
        <div class="col s12 m6 l4">
            <div class="card recipe{{ recipe_number }} recipe-card hoverable">
                <div class="card-image">
                    <img src="{{ recipe.image_url }}">
                    <span class="card-title text-shadow">{{ recipe.country }}</span>
                </div>
                <div class="card-content center-align">
                    <h5>{{ recipe.recipe_name }}</h5>
                    {{ is_recipe_page }}
                    <p>{{ recipe.recipe_description }}</p>
                </div>
                <div class="center-align" id="like_counter">
                    <form method="POST" action="{{ url_for('like_recipe') }}">
                        <input type="hidden" id="like_recipe" name="like_recipe" value="{{ recipe._id }}">
                        {% if session['user'] %}
                            <!-- https://jinja.palletsprojects.com/en/2.10.x/templates/#assignments -->
                            <!-- check if user has liked this recipe -->
                            {% set ns = namespace(found=false) %}
                            {% for likes in user_likes  %}
                                {% if likes|string == recipe._id|string %}
                                    {% set ns.found = true %}
                                {% endif %}
                            {% endfor %}
                            <!-- if user has already liked the recipe, colour icon blue -->
                            {% if ns.found %}
                                <button type="submit" id="like_button_blue" class="btn-floating blue">
                                    <i class="far fa-thumbs-up"></i>
                                </button>
                                <span id="liked">{{ recipe.likes }}</span>
                            {% else %}
                                <button type="submit" id="like_button" class="btn-floating">
                                    <i class="far fa-thumbs-up"></i>
                                </button>
                                <span id="not_liked">{{ recipe.likes }}</span>
                            {% endif %}
                        {% else %}
                        <a id="like_button" class="btn-floating modal-trigger" href="#modal2">
                            <i class="far fa-thumbs-up"></i>
                        </a>
                        <span>{{ recipe.likes }}</span>
                        {% endif %}
                    </form>
                </div>
                <div id="added_by">
                    <span>Added by: {{ recipe.added_by }}</span>
                </div>
                <div class="favourite">
                    <form method="POST" action="{{ url_for('add_to_favourites') }}">
                        <input type="hidden" id="fav_recipe" name="fav_recipe" value="{{ recipe._id }}">
                        {% if session['user'] %}
                            <!-- https://jinja.palletsprojects.com/en/2.10.x/templates/#assignments -->
                            <!-- check if user has liked this recipe -->
                            {% set ns = namespace(found=false) %}
                            {% for favourites in user_favourites  %}
                                {% if favourites|string == recipe._id|string %}
                                    {% set ns.found = true %}
                                {% endif %}
                            {% endfor %}
                            <!-- if user has already liked the recipe, colour icon blue -->
                            {% if ns.found %}
                                <button type="submit" class="btn-floating red">
                                    <i class="far fa-heart"></i>
                                </button>
                            {% else %}
                                <button id="favourite_button" type="submit" class="btn-floating">
                                    <i class="far fa-heart"></i>
                                </button>
                            {% endif %}
                        {% else %}
                        <a id="favourite" class="btn-floating modal-trigger" href="#modal2">
                            <i class="far fa-heart"></i>
                        </a>
                        {% endif %}
                    </form>
                </div>
                <div class="card-action center-align">
                    <form method="POST" action="{{ url_for('recipe_details') }}">
                        <input type="hidden" id="see_recipe" name="see_recipe" value="{{ recipe._id }}">
                        <button type="submit" class="btn waves-effect waves-light submit-buttons">
                            See Recipe
                        </button>
                    </form>
                </div>
            </div>
        </div>
        {%  endfor %}
    </div>
    
{% endblock %}
